<title>GridSite User Guide</title>
<body>
<h1 align=center>GridSite User Guide</h1>

<p><i>If you are setting up a GridSite-based website you may wish to use this 
file as the basis of your end-user documentation. If so, copy all of the
files from the GridSite doc directory (probably
<small>/usr/share/doc/gridsite-VERSION/</small>) 
to somewhere on your website like
<b>/gridsite-doc/</b> and add <b>GridSiteHelpURI /gridsite-doc/user.html</b>
to the virtual server configuration in
httpd.conf - you should also look through the rest of the HTML source since
there are some comments you may find helpful.</i>

<p> 
This Guide is intended for people using GridSite websites with conventional
web browsers, especially people with write access to areas of the site.
 There is a separate 
<a href="admin.html">Administration Guide</a>
 with additional information for people managing access control and group
membership. This Guide assumes you are familiar with basic Web and HTML
concepts. Towards the end we discuss how to access servers with command
line tools like curl and htcp. 

<h2>Reading from HTTP and HTTPS servers</h2>

<p>
GridSite servers are usually accessible both via HTTP and via HTTPS. You can
always tell which version you are using by looking at whether the URL in your
browser's location window starts with &quot;http://&quot; or 
&quot;https://&quot; HTTPS means that the connection to the server is
encrypted, that you can verify you're talking to the real server and not an
imposter, and gives you the option to authenticate to the site and perhaps
gain write access.

<p>
 Simple browsing of the website via HTTP or HTTPS is reasonably
 self-explanatory. If configured, additional links may appear in the footer
 of each webpage with links to this help, 
<!-- if  GridSiteHelpURI uri  is set --> 
 and to switch between HTTP and HTTPS versions of the page. Pages may also
 have a link to the page History, 
<!-- GridSiteAdminURI uri  must be set and gridsite-admin.cgi working for
 the history-viewing mechanism to work -->
 showing the dates of changes to that page and names of its authors.

<p>
 When looking at HTTPS pages, you may find your browser reports it cannot
 verify the server's certificate since it does not recognise the
 Certification Authority (CA) it uses. You should attempt to load the CA's
 root certificate into your browser to stop these warnings. (This means your
 browser will be able to identify any servers using fake certificates which
 you shouldn't trust.) How you obtain the CA Root Certificate from a
 trust-worthy source depends on the CA. For example, the UK e-Science CA
 lets you download it <a href="http://ca.grid-support.ac.uk/">from their
 website</a>.
<!-- if most of your users use one or two CAs, you could add a link to their
CA root cert loading instructions here -->

<h2>Authenticating</h2>

<p>
 To go beyond reading pages you need to obtain a user certificate and load it
 into your web browser. How you do this again depends on the Certification
 Authority you have access to (for most Grid projects, CAs are organised
 on a national basis.) To use the UK e-Science CA example again, 
 <a href="http://ca.grid-support.ac.uk/">from their website</a> has links to
 the procedure for applying for a certificate from within a web browser.
<!-- again, a link to your CA would be good here -->

<p>
A user certificate usually has a version of your name and affiliation as its
Distinguished Name (DN) - for example,
&quot;/C=UK/O=eScience/OU=Manchester/L=HEP/CN=Andrew McNab&quot;

<p>
Once you've obtained a user certificate in your name from your CA, you need
to make sure it is loaded into the browser you normally use to browse the
web. How you do this is different for different browsers and to some extent
for different CAs (but if you applied
for the CA through your browser, you may already have it there.)

<p>
Browsers want the certificate and private key in the PKCS#12 format, which
is normally a single file with the extension &quot;.p12&quot;.
Many programs which are based on OpenSSL, such as Globus and curl, prefer
the PEM (&quot;.pem&quot;) format for certificates, with separate
certificate and key files (&quot;usercert.pem&quot; and
&quot;userkey.pem&quot;, for example.) If you only have the files in .pem
format and have access to openssl, you
can use its command line tools to convert PEM to PKCS#12:
<pre>
openssl pkcs12 -in usercert.pem -inkey userkey.pem -export -out certkey.p12
</pre>

<p>
<b>Be very careful not to accidentally overwrite .pem or .p12 files when
doing this kind of thing! In particular, if you lose your private key, you
cannot retrieve it from your CA.</b>

<p>
 Once your user certificate is loaded, you should be able to see your
 certificate name appear when you look at an HTTPS GridSite page which has
 the page footers enabled - for example, the &quot;Switch to HTTP&quot; link
 present. If GridSite understands your user certificate, it displays a
 &quot;You are ...&quot; line in the footer. (However, the Apache webserver
 must also be set up with your CAs root certificate for this to work. The
 <a href="https://www.gridpp.ac.uk/">GridPP HTTPS home page</a> is set up
 to recognise a good range of European and North American Grid CAs.)
<!-- the CA root certificates normally go somewhere like
/etc/grid-security/certificates and httpd.conf should reflect this with the
directive   SSLCACertificatePath /etc/grid-security/certificates  -->

<h2>Authorization</h2>

<p>
 Once users can prove their identity to the web server, it then becomes
 possible to give them appropriate rights depending on that identity.
 GridSite allows site administrators to specify these rights for individuals
 and groups using 
<a href="gacl.html">GACL</a>
 access control files. (The
<a href="admin.html">Administration Guide</a>
 explains how to manage these files.) GACL defines who can
 read files, who can list directories,
 who can write or create files and who can modify the GACL policy files. To
 get increased access to an area of a site, you need to contact the
 administrator for that area and give the DN of your certificate (it's not
 necessary to send any certificate files.)

<h2>Managing Directories and Files</h2>

<p>
If you have list permission for the directory containing a page, you should
see an extra link &quot;Manage Directory&quot; in the page's set of footer
links, which allows you to browse the directory even if the normal
index.html is present. If page histories are available, this listing view
also has links to them.

<p>
The real power of GridSite becomes available if you have write access to a
directory. In that case, the &quot;Manage Directory&quot; page has
additional links to Delete or Rename pages and other files, and to Edit HTML
and plain text files. An Edit link also appears in the footer links of HTML
pages.

<p>
If you use the Edit function, you are presented with an HTML form containing
the current filename and the full HTML or plain text of the page for you to
edit. This allows you to maintain the content of the site &quot;in
place&quot; and to see the result of your changes immediately, in context.

<p>
If you modify the filename in the form before saving, GridSite will make a
new file with that name, and the old file will still be present, unmodified.
(However, you cannot use this feature for creating a file in a different
directory.)
As you make changes, the history of the changes and your certificate DN are
recorded, and available in the history page for that file.

<p>
 For people with write access, the &quot;Manage Directory&quot; page also has
 options to upload a file from the computer your browser is running on, and to
 create files and directories. If it's enabled, you can also view the
 contents of WinZIP / PKZIP / .zip files, and unpack their contents into the
 current directory. (This feature is very useful if you have several files
 to upload at one time.)
<!-- This needs the  GridSiteUnzip path  directive in httpd.conf -->

<h2>HTML Formatting in GridSite</h2>

<p>
As well as providing access control and file management, GridSite provides
some simple formatting of HTML pages by adding standard headers and footers.
(If this isn't sufficient, GridSite will happily coexist with HTML
preprocessor languages like SSI, PHP and JSP.)

<p>
 If HTML formatting is enabled
 for the current directory, GridSite looks for the files gridsitehead.txt and
 gridsitefoot.txt in that directory, or goes up through the parent
 directories until they are found. 
<!-- GridSiteHtmlFormat on  turns this on and  GridSiteHeadFile file  and
GridSiteFootFile file  can change the names of the header and footer. If 
you change from the defaults, you need to change this paragraph. -->

<p>
The &lt;body&gt; and &lt;/body&gt; tags from the HTML file are replaced with
the contents of the gridsitehead.txt and gridsitefoot.txt files, which
should normally be chunks of HTML including a replacement &lt;body&gt;
or &lt;/body&gt; tag. If either tag is absent from the original page, then
the header or footer is just added rather than being inserted in place of
the tag. (One consequence of this absence is that HTML header tags like
&lt;title&gt; can end up after a &lt;body&gt; tag, and can get ignored by
browsers - so always include &lt;body&gt; ... &lt;/body&gt; in your pages.)

<p>
This simple system is suprisingly flexible, and allows a variety of top and
bottom, or sidebar navigation layouts of pages. Since the &lt;body ...&gt;
tag is under full control of the author of the gridsitehead.txt file,
backgrounds, colour schemes and style sheets can easily be specified. 

<p>
For example:

<p>
<table border=1 cellpadding=3>
<tr><th>Source</th><th>HTML</th></tr>
<tr><td>page.html</td><td>&lt;title&gt;PAGE TITLE&lt;/title&gt;</td></tr>
<tr><td>page.html<br>(replaced)</td><td>&lt;body&gt;</td></tr>
<tr><td>gridsitehead.txt</td>
    <td>&lt;body text=blue&gt;<br>
        Heading text<br>
        &lt;table border=1&gt;<br>&lt;tr&gt;<br>&lt;td&gt;Standard&lt;br&gt;<br>
        sidebar&lt;/td&gt;<br>&lt;td&gt;</td></tr>
<tr><td>page.html</td><td>&lt;p&gt;<br>Page content...</td></tr>
<tr><td>page.html<br>(replaced)</td><td>&lt;/body&gt;</td></tr>
<tr><td>gridsitefoot.txt</td><td>&lt;/td&gt;<br>&lt;/tr&gt;<br>
        &lt;/table&gt;<br>Footer text<br>&lt;/body&gt;</td></tr>
</table>

<p>
produces pages with a layout like:

<p>
<table border=1 cellpadding=3>
<tr><td colspan=2>Heading text</td></tr>
<tr><td>Standard<br>sidebar</td><td>Page content...</td><tr>
<tr><td colspan=2>Footer text</td></tr>
</table>

<h2>Command line use</h2>

<p>
GridSite adds support for the HTTP PUT and DELETE methods, and this makes it
easy to create or delete files from within programs and commands without
using a web browser and HTML forms. It is straightforward, although slightly
awkward, to use a standard HTTPS-aware client like 
<a href="http://curl.haxx.se/">curl</a> to upload files, but GridSite
provides htcp as a more convenient client program, which is easier to use
with GSI Proxies and X.509 user certificates, and has a syntax closer to the
familiar scp command.

<p>
The following examples assume the GridSite server has GSI support and use a
GSI proxy as the client certificate. For non-GSI use, just skip the
grid-proxy-init stage, and replace the proxy
filename with $HOME/.globus/usercert.pem and $HOME/.globus/userkey.pem (or
wherever your PEM format certificate and key are stored.)

<p>
First generate a GSI proxy with grid-proxy-init. This will create a proxy file
in /tmp/x509up_uXXXXX where XXXXX is your Unix UID (also given by <b>id
-u</b>.) The GSI proxy contains a
temporary private key and certificate signed by your long-term user
certificate.

<p>
You should make sure you have a copy of the CA root certificates of the CA's
used by the servers you wish to talk to. These are usually installed in
/etc/grid-security/certificates as files like 01621954.0, and RPMs and tar
files for many common European and North American CAs are available from
<a href="https://datagrid.in2p3.fr/distribution/datagrid/security/">
https://datagrid.in2p3.fr/distribution/datagrid/security/</a>

<p>
To upload a file with curl:
<pre>
curl --cert /tmp/x509up_u`id -n` --key /tmp/x509up_u`id -n` \
     --capath /etc/grid-security/certificates \
     --upload-file /tmp/new.file.txt https://server/new.file.txt
</pre>

<p>
The equivalent htcp command is:
<pre>
htcp /tmp/new.file.txt https://server/new.file.txt
</pre>
since htcp looks for the GSI proxy and CA certificates automatically. htcp
can also be used to copy remote files to the local machine by reversing the
arguments. For more details, see the 
<a href="htcp.1.html">htcp(1)</a>  man page.

<p>
htcp also has options for deleting files, and doing short or long listings,
and these can also be accessed using the htrm, htls and htll commands (which
are normally symbolic links to htcp.)

<p>
Directory indexes are based on parsing the index returned by the web server
and by using the HTTP HEAD method to obtain the file size and modification
times.

<p>
All of the ht** commands can accept multiple source file arguments, and this
allows you to copy multiple files to or from the server. Shell wildcard
expansion on the local machine is especially useful:
<pre>
htcp /tmp/new.*.txt https://server/
</pre>

</body>
