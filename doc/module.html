<title>GridSite Apache module: mod_gridsite</title>
<body>
<h1 align=center>GridSite Apache module: mod_gridsite</h1>

<p> 
mod_gridsite is an Apache 2.0 module which enforces access control via Grid
Access Control Lists, and X.509, GSI or VOMS credentials. mod_gridsite also
gives Apache built-in support for the HTTP PUT and DELETE methods, and
formatting of HTML pages with standard headers and footers.

<p>
Since mod_gridsite access
control within Apache itself, Grid authorization and
the associated verified credentials are available to all technologies
supported by Apache, including static file serving, SSI, CGI, PHP, mod_perl
and Java servlets via a connector to Tomcat.

<p>
Operation of mod_gridsite can be configured using runtime directives
in Apache's standard httpd.conf configuration file. The module must first be
loaded with a LoadModule directive:

<p>
<b>LoadModule gridsite_module /PATH/TO/MODULES/mod_gridsite.so</b>

<p>
The module's behaviour is then controlled by GridSite... directives within
Apache &lt;Directory ...&gt; sections, allowing different directories to use
GridSite features in different ways.

<h2>GridSite directives</h2>

<dl>
<dt><b>GridSiteIndexes on|off</b>
<dd>Determines whether GridSite generates HTML directory listings. These
    have some advantages over standard Apache directory listings (eg the
    displayed filenames are never truncated) and will include standard
    headers and footers if GridSiteHtmlFormat is on. 
    <br>
    (Default: GridSiteIndexes off)
<p>

<dt><b>GridSiteIndexHeader file</b>
<dd>If the named file is found in the directory being listed, the file
    is included verbatim at the top of the listing and excluded from
    the file-by-file listing. The file can either be HTML or plain text (in
    which case browsers will be treat it as one HTML paragraph.) 
    <br>
    (Default: none)
<p>

<dt><b>GridSiteHtmlFormat on|off</b>
<dd>Determines where HTML pages receive additional formatting before being
    sent to the client. This includes the &quot;Last modified&quot;,
    &quot;View page history&quot;, &quot;Switch to HTTP(S)&quot;,
    &quot;Print View&quot; and &quot;Built with GridSite&quot; footer
    elements. If header and footer files are found, they will be used too.
    <br>
    (Default: GridSiteHtmlFormat off)
<p>

<dt><b>GridSiteHeadFile file</b><br>
    <b>GridSiteFootFile file</b>
<dd>Set the filenames to be searched for as standard headers and footers
    for HTML pages. For each HTML page, the directory of that page is tried
    first, and then parent directories in ascending order until a header / 
    footer file is found. Header files are inserted in place of HTML
    &lt;body[ ...]&gt; tags; footer files in place of &lt;/body&gt;. (These
    standard files should each include the appropriate body tag as a
    replacement.)
    <br>
    (Defaults: GridSiteHeadFile gridsitehead.txt, 
     GridSiteFootFile gridsitefoot.txt)
<p>

<dt><b>GridSiteAuth on|off</b>
<dd>Enables GridSite access control features, using 
    <a href="gacl.html">GACL</a> files. The files are named .gacl and are
    per-directory. The current directory is tried and then parent
    directories in ascending order until a .gacl file is found. 
    <br>
    (Default: GridSiteAuth off)
<p>

<dt><b>GridSiteAdminList uri</b>
<dd>All members of the DN List with name &quot;uri&quot; receive the full set
    of permissions, irrespective of per-directory .gacl files. People in
    this group have full control over the whole site.
    <br>
    (Default: none)
<p>

<dt><b>GridSiteGSIProxyLimit limit</b>
<dd>When using GSI Proxy credentials,
    proxies with delegation depth greater than &quot;limit&quot; will
    be ignored by mod_gridsite authorization decisions. A limit of zero 
    implies only full X.509
    certificates (and no proxies) will be accepted. A limit of 1 implies
    that only the initial proxy, usually created on the user's own machine,
    is acceptable. Higher levels lead to proxies on remote machines, eg
    used by running jobs, being accepted.
    <br>
    (Default: GridSiteGSIProxyLimit 1)
<p>

<dt><b>GridSiteMethods [GET] [PUT] [DELETE]</b>
<dd>Specifies which HTTP methods are supported by GridSite. GET (and HEAD)
    are always supported. PUT and DELETE support is turned on by this
    directive, subject to a positive statement that write permission is
    allowed for the directory in question, by a GACL file.
    <br>
    (Default: GridSite GET)
<p>

<dt><b>GridSiteDNlists directory1[:directory2[:directory3]...]</b>
<dd>Sets up the DN List path used by <a href="gacl.html">GACL</a> for
    evaluating &lt;dn-list&gt; credentials. If this directive is not used,
    then GACL will use the GRST_DN_LISTS variable from Apache's own
    environment. If that is not set either, then /etc/grid-security/dn-lists
    is searched.
    <br>
    (Default: none)
<p>

<dt><b>GridSiteDNlistsURI uri</b>
<dd>If GridSiteDNlistsURI is used, then the URI given appears to be 
    populated with all the DN lists on the current DN lists path which
    match the current server. That is, for server https://example.org/ 
    with DN lists URI /dn-lists/, all DN lists with URLs starting
    https://example.org/dn-lists/ will appear to be present in /dn-lists/,
    irrespective of where in the path they are stored.    
    <br>
    (Default: none)
<p>

<dt><b>GridSiteAdminURI uri</b>
<dd>GridSiteAdminURI gives the absolute URI on the server of the GridSite
    Admin CGI program, which is used for file management, HTML and GACL 
    editing. This should be used in conjunction with the standard Apache
    directive ScriptAlias to map that URI to the real-gridsite-admin.cgi
    executable. For example:
    <br>
    <b>ScriptAlias /real-gridsite-admin.cgi
    /PATH/TO/real-gridsite-admin.cgi</b>
    <br>
    This URI is always reached by an internal redirection from the value
    set by GridSiteAdminFile, and is never visible to users.
    <br>
    (Default: none)
<p>

<dt><b>GridSiteAdminFile cgifilename</b>
<dd>If GridSiteAdminURI is set, then the cgifilename of GridSiteAdminFile
    appears to be present in all directories when explicitly
    requested (it does not appear in directory listings.) Requests for these
    ghost CGI URIs are internally redirected to the value set by 
    GridSiteAdminURI. 
    <br>
    (Default: GridSiteAdminFile gridsite-admin.cgi)
<p>

<dt><b>GridSiteEnvs on|off</b>
<dd>This makes mod_gridsite export several variables into the environment
    of CGI programs and other dynamic content systems. The variable names
    are listed below. For gridsite-admin.cgi mechanism to work, this switch
    must be left in its default state of on.
    <br>
    (Default: GridSiteEnvs on)
<p>

<dt><b>GridSiteEditable [ext1 [ext2 [ext3] ...]]]</b>
<dd>A space-separated list of file extensions which can safely be edited
    by the GridSite Text/HTML editor. The extensions are given without the
    initial dot.
    <br>
    (Default: GridSiteEditable txt shtml html htm css js php jsp)
<p>

<dt><b>GridSiteHelpURI uri</b>
<dd>If set, gives the URI to use for &quot;Website Help&quot; links in HTML
    page footers.
    <br>
    (Default: none)
<p>

<dt><b>GridSiteLink on|off</b>
<dd>Turns off the link in the HTML page footers which gives credit to
    GridSite.
    <br>
    (Default: GridSiteLink on)
<p>

<dt><b>GridSiteUnzip path</b>
<dd>If &quot;path&quot; is set by this directive, then real-gridsite-admin.cgi
    will offer to list the contents of .zip archives on the server. 
    Users with write access are able to unpack the contents into the same
    directory as the .zip file. The value of &quot;path&quot; must point
    to the location of the 
    <a href="http://www.info-zip.org/UnZip.html">unzip</a> binary.
    <br>
    (Default: none)
<p>

<dt><b>GridSiteDowngrade on|off</b>
<dd>Enable HTTPS Downgrade for this server, virtual server or directory:
    HTTPS requests made with the header HTTP-Downgrade-Size: 
    will be redirected to an HTTP version of the file, unless the file is
    smaller than the given size.
    <br>
    (Default: off)
<p>

<dt><b>GridSiteAuthCookiesDir path</b>
<dd>Location of authentication cookies directory, relative to ServerRoot.
    Used by HTTPS Downgrade to record the credentials obtained via HTTPS,
    and available to the corresponding HTTP request.
    <br>
    (Default: gridauthcookies)
<p>

<dt><b>GridSiteACLFormat GACL|XACML</b>
<dd>Format to use when writing .gacl files. (Both formats are automatically
    recognised when reading.)
    <br>
    (Default: GACL)
<p>

<dt><b>GridSiteExecMethod nosetuid|suexec|X509DN|directory</b>
<dd>Execution strategy for CGI scripts and executables. For options other
    than nosetuid, suexec (or gsexec renamed suexec) must installed. For
    X509DN and directory, gsexec must be installed, as suexec. 
    <br>
    With X509DN, the CGI process runs as a pool user, detemined using lock
    files in the pool mapping directory chosen as build time of gsexec.
    (/var/www/execmapdir by default.) The pool user is chosen according
    to the client's full certificate X.509 DN (ie without any GSI proxy
    name components.)
    <br>
    With directory, the CGI process runs as a pool user chosen according
    to the directory in which the CGI is located: all CGIs in that directory
    run as the same pool user.
    <br>
    (Default: nosetuid)
<p>

<dt><b>GridSiteUserGroup user group</b>
<dd>Unix user and group when using suexec (or gsexec as suexec.) This
    is equivalent to the suexec SuexecUserGroup directive, but can be
    specified on a per-directory basis.
    <br>
    (Default: none)
<p>

<dt><b>GridSiteDiskMode GroupNone|GroupRead|GroupWrite WorldNone|WorldRead</b>
<dd>The file creation permissions mode, taking two arguments to specify
    the group and other permissions. The mode always includes read and write
    permission for the CGI user itself.
    <br>
    (Default: GroupNone WorldNone)
<p>

</dl>

<h2>Environment variables</h2>

<p>
The following variables are present in the environment of CGI programs and
other dynamic content systems if the <b>GridSiteEnvs on</b> directive is
in effect.

<p>
<dl>
<dt><b>GRST_PERM</b>
<dd>Numerical value of the permission bit-map obtained by comparing the
    user with the GACL in force. (These should be tested using the
    GRSTgaclPermHasXXXX functions from GACL.)
<p>

<dt><b>GRST_ADMIN_LIST</b>
<dd>URI of the DN List, listing people with full admin and write access
    to the whole site.
<p>

<dt><b>GRST_GSIPROXY_LIMIT</b>
<dd>Maximum valid delegation level for GSI Proxies.
<p>

<dt><b>GRST_DIR_PATH</b>
<dd>Absolute path in the local filesystem to the directory holding the
    file being requested.
<p>

<dt><b>GRST_DESTINATION_TRANSLATED</b>
<dd>Present if a WebDAV Destination header was given in the request with a
    local URL. Contains the translation of the URL given into an
    absolute path in the local filesystem.
<p>

<dt><b>GRST_HELP_URI</b>
<dd>URI of website help pages set by GridSiteHelpURI directive.
<p>

<dt><b>GRST_ADMIN_FILE</b>
<dd>Filename of per-directory ghost gridsite-admin.cgi program. (This is
    used by real-gridsite-admin.cgi to construct links in its pages.)
<p>

<dt><b>GRST_EDITABLE</b>
<dd>Space-separated list of extensions which can safely be edited with a
    Text/HTML editor.
<p>

<dt><b>GRST_HEAD_FILE</b> and <b>GRST_FOOT_FILE</b>
<dd>Filenames of standard header and footer files.
<p>

<dt><b>GRST_DN_LISTS</b>
<dd>DN lists search path.
<p>

<dt><b>GRST_DN_LISTS_URI</b>
<dd>Directory of virtual URIs used to publish this site's DN Lists.
<p>

<dt><b>GRST_UNZIP</b>
<dd>Full path to the unzip binary, used to list and unpack .zip files.
<p>

<dt><b>GRST_NO_LINK</b>
<dd>If set, do not include credit links to GridSite in page footers.
<p>

<dt><b>GRST_ACL_FORMAT</b>
<dd>Format to use when writing .gacl files: either GACL or XACML.
<p>

<dt><b>GRST_EXEC_METHOD</b>
<dd>Specified by GridSiteExecMethod, either suexec, X509DN or directory.
<p>

<dt><b>GRST_EXEC_DIRECTORY</b>
<dd>The directory containing the CGI script or executable (used by gsexec
    to determine which pool account to use in directory mapping mode.)
<p>

<dt><b>GRST_DISK_MODE</b>
<dd>The <b>Apache</b> disk permission modes bit pattern, in hexadecimal,
    starting with 0x. 
    (Similar to the Unix bit pattern, except with hexadecimal rather than
    octal values: eg 0x600 [Apache] vs 0600 [Unix] 
    are both read/write for user only.)
<p>

</dl>

</body>
